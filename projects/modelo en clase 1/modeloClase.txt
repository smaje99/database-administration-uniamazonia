drop database if exists salsamentaria;

create database salsamentaria;

use salsamentaria;

create table salsamentaria.sexo(
 id_sexo int not null,
 nombre_sexo varchar(45) not null
);

create table salsamentaria.tipo_identificacion (
  id_identificacion int not null ,
  nombre_dentificacion varchar(45) not null,
  estado_identificacion tinyint(1) not null -- 0 127
);

create table salsamentaria.persona(
 id_persona int not null ,
 nombre_persona varchar(45) not null,
 apellido_persona varchar(45) not null,
 numero_identificacion varchar(13) not null,
 email_persona varchar(45) not null,
 id_sexo int not null,
 id_identificacion int not null
);

create table salsamentaria.telefono_persona (
  id_telefono int not null ,
  numero_telefono varchar(13) not null,
  estado_telefono tinyint(1) not null,
  id_persona int not null
);

create table salsamentaria.proveedor(
  id_proveedor int not null ,
  razon_social varchar(45) not null,
  estado_proveedor tinyint(1) not null,
  id_persona int not null
);

create table salsamentaria.tipo_cliente (
  idtipo_cliente int not null ,
  tipo_cliente varchar(45) not null
);

create table salsamentaria.cliente (
  id_cliente int not null ,
  razon_social varchar(45) not null,
  estado_cliente tinyint(1) not null,
  id_persona int not null,
  idtipo_cliente int not null
 );

create table salsamentaria.rol (
  id_rol int not null ,
  nombre_rol varchar(45) not null,
  estado_rol tinyint(1) not null
);

create table salsamentaria.usuario (
  id_usuario int not null ,
  nombre_usuario varchar(45) not null,
  contrasenia_usuario varchar(45) not null,
  estado_usuario tinyint(1) not null,
  id_persona int not null,
  id_rol int not null
);

create table salsamentaria.forma_pago (
  idforma_pago int not null ,
  forma_pago varchar(45) not null,
  estadoforma_pago tinyint(1) not null
);

create table salsamentaria.venta (
  id_venta int not null ,
  valortotal_venta double not null,
  fecha_venta datetime not null,
  total_iva double not null,
  subtotal_venta double not null,
  saldo_venta double not null,
  total_descuento double not null,
  id_usuario int not null,
  idforma_pago int not null,
  id_cliente int not null
 );

create table salsamentaria.credito (
  id_credito int not null ,
  saldo_credito double not null,
  total_abono double not null,
  estado_credito tinyint(1) not null,
  id_venta int not null
);

create table salsamentaria.abono (
  id_abono int not null ,
  valor_abono double not null,
  fecha_abono datetime not null,
  id_credito int not null
);

create table salsamentaria.compra (
  id_compra int not null ,
  valortotal_compra double not null,
  fecha_compra datetime not null,
  subtotal_compra double not null,
  totaliva_compra double not null,
  id_proveedor int not null
  );

create table salsamentaria.marca_producto (
  id_marca int not null ,
  nombre_marca varchar(45) not null,
  estado_marca tinyint(1) not null
  );

create table salsamentaria.unidad_medida_producto (
  idunidad_medida int not null ,
  nombreunidad_medida varchar(45) not null,
  siglasunidad_medida varchar(5) not null,
  estadounidad_medida tinyint(1) not null
 );

create table salsamentaria.categoria_producto (
  id_categoria int not null ,
  nombre_categoria varchar(45) not null,
  estado_categoria tinyint(1) not null
 );

create table salsamentaria.tipo_producto (
  idtipo_producto int not null ,
  tipo_producto varchar(45) not null,
  estadotipo_producto tinyint(1) not null
  );

create table salsamentaria.producto (
  id_producto int not null ,
  precio_producto double not null,
  descripcion_producto varchar(45) not null,
  cantidad_producto int not null,
  estado_producto tinyint(1) not null,
  id_marca int not null,
  idunidad_medida int not null,
  id_categoria int not null,
  idtipo_producto int not null
);

create table salsamentaria.detalle_compra (
  subtotaldetalle_compra double not null,
  cantidaddetalle_compra int not null,
  valor_unitario double not null,
  lotedetalle_compra varchar(20) not null,
  vencimientodetalle_compra date not null,
  id_compra int not null,
  id_producto int not null
);

 create table salsamentaria.detalle_venta (
  cantidaddetalle_venta int not null,
  subtotaldetalle_venta double not null,
  id_venta int not null,
  id_producto int not null
);

-- primary key

alter table salsamentaria.sexo add constraint primary key(id_sexo);

alter table salsamentaria.tipo_identificacion  add constraint primary key(id_identificacion);

alter table salsamentaria.persona add constraint primary key(id_persona);

alter table salsamentaria.telefono_persona add constraint primary key(id_telefono);

alter table salsamentaria.proveedor add constraint primary key(id_proveedor);

alter table salsamentaria.tipo_cliente add constraint primary key(idtipo_cliente);

alter table salsamentaria.cliente add constraint primary key(id_cliente);

alter table salsamentaria.rol add constraint primary key(id_rol);

alter table salsamentaria.usuario add constraint primary key(id_usuario);

alter table salsamentaria.forma_pago add constraint primary key(idforma_pago);

alter table salsamentaria.venta add constraint primary key(id_venta);

alter table salsamentaria.credito add constraint primary key(id_credito);

alter table salsamentaria.abono add constraint primary key(id_abono);

alter table salsamentaria.compra add constraint primary key(id_compra);

alter table salsamentaria.marca_producto add constraint primary key(id_marca);

alter table salsamentaria.unidad_medida_producto add constraint primary key(idunidad_medida);

alter table salsamentaria.categoria_producto add constraint primary key(id_categoria);

alter table salsamentaria.tipo_producto add constraint primary key(idtipo_producto);

alter table salsamentaria.producto add constraint primary key(id_producto);

alter table salsamentaria.detalle_compra add constraint primary key(id_compra,id_producto);

alter table salsamentaria.detalle_venta add constraint primary key(id_venta,id_producto);

-- foreign key

alter table persona add constraint fk_persona_sexo foreign key (id_sexo)
references salsamentaria.sexo(id_sexo)
on  delete no action 
on update no action;

alter table persona add constraint fk_persona_tipo_identificacion foreign key (id_identificacion)
references salsamentaria.tipo_identificacion(id_identificacion)
on  delete no action -- 
on update no action;

alter table telefono_persona add constraint fk_telefono_persona_persona foreign key (id_persona)
references salsamentaria.persona (id_persona)
on  delete no action 
on update no action;

alter table proveedor add constraint fk_proveedor_persona foreign key (id_persona)
references salsamentaria.persona (id_persona)
on  delete no action 
on update no action;

alter table cliente add constraint fk_cliente_tipo_cliente foreign key (idtipo_cliente)
references salsamentaria.tipo_cliente (idtipo_cliente)
on  delete no action 
on update no action;

alter table cliente add constraint fk_cliente_persona foreign key (id_persona)
references salsamentaria.persona (id_persona)
on  delete no action 
on update no action;

alter table usuario add constraint fk_usuario_persona foreign key (id_persona)
references salsamentaria.persona (id_persona)
on  delete no action 
on update no action;

alter table usuario add constraint fk_usuario_rol foreign key (id_rol)
references salsamentaria.rol(id_rol)
on  delete no action 
on update no action;


alter table venta add constraint fk_venta_forma_pago foreign key (idforma_pago)
references salsamentaria.forma_pago(idforma_pago)
on  delete no action 
on update no action;

alter table venta add constraint fk_venta_cliente foreign key (id_cliente)
references salsamentaria.cliente(id_cliente)
on  delete no action 
on update no action;

alter table venta add constraint fk_venta_usuario foreign key (id_usuario)
references salsamentaria.usuario(id_usuario)
on  delete no action 
on update no action;

alter table credito add constraint fk_credito_venta foreign key (id_venta)
references salsamentaria.venta(id_venta)
on  delete no action 
on update no action;

alter table abono add constraint fk_abono_credito foreign key (id_credito)
references salsamentaria.credito(id_credito)
on  delete no action 
on update no action;


alter table compra add constraint fk_compra_proveedor foreign key (id_proveedor)
references salsamentaria.proveedor(id_proveedor)
on  delete no action 
on update no action;

alter table producto add constraint fk_producto_marca_producto foreign key (id_marca)
references salsamentaria.marca_producto(id_marca)
on  delete no action 
on update no action;

alter table producto add constraint fk_producto_unidad_medida_producto foreign key (idunidad_medida)
references salsamentaria.unidad_medida_producto(idunidad_medida)
on  delete no action 
on update no action;

alter table producto add constraint fk_producto_categoria_producto foreign key (id_categoria)
references salsamentaria.categoria_producto(id_categoria)
on  delete no action 
on update no action;

alter table producto add constraint fk_producto_tipo_producto foreign key (idtipo_producto)
references salsamentaria.tipo_producto(idtipo_producto)
on  delete no action 
on update no action;


alter table detalle_compra add constraint fk_detalle_compra_producto foreign key (id_producto)
references salsamentaria.producto(id_producto)
on  delete no action 
on update no action;

alter table detalle_compra add constraint fk_detalle_compra_compra foreign key (id_compra)
references salsamentaria.compra(id_compra)
on  delete no action 
on update no action;

alter table detalle_venta add constraint fk_detalle_venta_producto foreign key (id_producto)
references salsamentaria.producto(id_producto)
on  delete no action 
on update no action;

alter table detalle_venta add constraint fk_detalle_venta_venta foreign key (id_venta)
references salsamentaria.venta(id_venta)
on  delete no action 
on update no action;

-- alter table 

alter table salsamentaria.telefono_persona modify column numero_telefono bigint not null;

alter table salsamentaria.persona modify column numero_identificacion bigint not null;

alter table salsamentaria.tipo_identificacion modify column estado_identificacion char(1) not null;
alter table salsamentaria.tipo_identificacion add constraint checkestado_identificacion check(salsamentaria.tipo_identificacion.estado_identificacion in ("i", "a"));

alter table salsamentaria.telefono_persona modify column estado_telefono char(1) not null;
alter table salsamentaria.telefono_persona add constraint checkestado_telefono check(salsamentaria.telefono_persona.estado_telefono in ("i","a")); 

alter table salsamentaria.proveedor modify column estado_proveedor char(1) not null;
alter table salsamentaria.proveedor add constraint checkestado_proveedor check(salsamentaria.proveedor.estado_proveedor in ("i","a"));

alter table salsamentaria.cliente modify column estado_cliente char(1) not null;
alter table salsamentaria.cliente add constraint checkestado_cliente check(salsamentaria.cliente.estado_cliente in ("i","a")); 

alter table salsamentaria.rol modify column estado_rol char(1) not null;
alter table salsamentaria.rol add constraint checkestado_rol check(salsamentaria.rol.estado_rol in("i","a"));

alter table salsamentaria.usuario modify column estado_usuario char(1) not null;
alter table salsamentaria.usuario add constraint checkestado_usuario check(salsamentaria.usuario.estado_usuario in ("i","a"));

alter table salsamentaria.forma_pago modify column estadoforma_pago char(1) not null;
alter table salsamentaria.forma_pago add constraint checkestadoforma_pago check(salsamentaria.forma_pago.estadoforma_pago in ("i","a"));

alter table salsamentaria.credito modify column estado_credito char(1) not null;
alter table salsamentaria.credito add constraint checkestado_credito check(salsamentaria.forma_pago.estado_credito in ("i","a"));

alter table salsamentaria.abono add column estado_abono tinyint(1) not null;
alter table salsamentaria.abono modify column estado_abono char(1) not null;
alter table salsamentaria.abono add constraint checkestado_abono check(salsamentaria.abono.estado_abono in ("i","a"));

alter table salsamentaria.marca_producto modify column estado_marca char(1) not null;
alter table salsamentaria.marca_producto add constraint checkestado_marca check(salsamentaria.marca_producto.estado_marca in ("i","a"));

alter table salsamentaria.unidad_medida_producto modify column estadounidad_medida char(1) not null;
alter table salsamentaria.unidad_medida_producto add constraint checkestadounidad_medida check(salsamentaria.unidad_medida_producto.estadounidad_medida in ("i","a"));

alter table salsamentaria.categoria_producto modify column estado_categoria char(1) not null;
alter table salsamentaria.categoria_producto add constraint checkestado_categoria check(salsamentaria.categoria_producto.estado_categoria in ("i","a"));

alter table salsamentaria.tipo_producto modify column estadotipo_producto char(1) not null;
alter table salsamentaria.tipo_producto add constraint checkestadotipo_producto check(salsamentaria.tipo_producto.estadotipo_producto in ("i","a"));

alter table salsamentaria.producto modify column estado_producto char(1) not null;
alter table salsamentaria.producto add constraint checkestado_producto check(salsamentaria.producto.estado_producto in ("i","a"));

-- insert 

insert into sexo(id_sexo ,nombre_sexo) 
values(1,"masculino"),
(2,"femenino"),
(3,"otro");

-- tipo_identificacion

insert into salsamentaria.tipo_identificacion(id_identificacion,nombre_dentificacion,estado_identificacion)
values(1,"cedula","a"),
(2,"tarjeta indentidad","i"),
(3,"cedula extranjera","a"),
(4,"pasaporte","i"),
(5,"visa","a"),
(6,"contrase√±a","i"),
(7,"otro","a");

-- persona

insert into salsamentaria.persona(id_persona,nombre_persona,apellido_persona,numero_identificacion,email_persona,id_sexo,id_identificacion)
values(1,"maia fernanda","rojas vargas",1006507063,"mf@gmail.com",2,1),
(2,"juliana","guerrero",1005341345,"jg@gmail.com",2,2),
(3,"luis fernando","rodriguez martinez",1011567890,"lr@gmail.com",1,3),
(4,"edgar julian","claros",1003456721,"eg@gmail.com",1,4),
(5,"karen tatiana","isaza cabrera",1003345123,"ki@gmail.com",2,5),
(6,"mariana","marquez gonzales",1011678232,"mm@gmail.com",2,4),
(7,"el sharawy","rodriguez morales",1003456711,"erm@gmail.com",1,6);

-- telefono_persona

INSERT INTO salsamentaria.telefono_persona (id_telefono,numero_telefono,estado_telefono,id_persona) VALUES
	 (1,3138734693,"a",1),
	 (2,3114885735,"i",2),
	 (3,3201235671,"a",3),
	 (4,3128901232,"i",1),
	 (5,3025431466,"a",5),
	 (6,3102912297,"i",6),
	 (7,3146547890,"a",4);

-- rol

insert into salsamentaria.rol(id_rol,nombre_rol,estado_rol)
values(1,"administrador","a"),
(2,"invitado","i"),
(3,"empleado","a"),
(4,"administrador","i"),
(5,"invitado","i"),
(6,"empleado","a");

-- usuario 
insert into salsamentaria.usuario (id_usuario,nombre_usuario,contrasenia_usuario,estado_usuario,id_persona,id_rol)
values(1,"mf@gmail.com","mf2313","a",1,1),
(2,"jg@gmail.com","jg1234","i",2,2),
(3,"lr@gmail.com","lr1234","a",3,3),
(4,"eg@gmail.com","eg3456","i",4,3),
(5,"ki@gmail.com","ki1245","a",5,1),
(6,"mm@gmail.com","mm3436","i",6,2),
(7,"erm@gmail.com","er5689","a",7,1);

-- tipo_cliente

insert into salsamentaria.tipo_cliente (idtipo_cliente,tipo_cliente) values
	 (1,"ocacional"),
	 (2,"permanente"),
	 (3,"otro");

-- cliente
	
insert into salsamentaria.cliente (id_cliente ,razon_social,estado_cliente,id_persona,idtipo_cliente) values
	 (1,"cliente 1","a",1,1),
	 (2,"cliente 2","i",2,1),
	 (3,"cliente 3","a",3,2),
	 (4,"cliente 4","i",1,2),
	 (5,"cliente 5","a",2,1),
	 (6,"cliente 6","i",3,3),
	 (7,"cliente 7","a",4,3);

-- proveedor
	
insert into salsamentaria.proveedor (id_proveedor ,razon_social,estado_proveedor,id_persona) values
	 (1,"proveedor 1","a",1),
	 (2,"proveedor 2","i",2),
	 (3,"proveedor 3","a",3),
	 (4,"proveedor 4","i",1),
	 (5,"proveedor 5","a",4),
	 (6,"proveedor 6","i",3),
	 (7,"proveedor 7","a",2);

	
	
-- forma_pago
	
insert into salsamentaria.forma_pago (idforma_pago,forma_pago,estadoforma_pago) values
	 (1,"efectivo","a"),
	 (2,"credito","i"),
	 (3,"tarjeta credito","a"),
	 (4,"credito","i"),
	 (5,"efectivo","a"),
	 (6,"tarjeta credito","i"),
	 (7,"otro","a");
	
-- compra
	
insert into salsamentaria.compra (id_compra ,valortotal_compra,fecha_compra,subtotal_compra,totaliva_compra,id_proveedor) values
	 (1,1000000.0,"2022-04-12 00:00:00",100000.0,10000.0,1),
	 (2,900000.0,"2022-04-01 00:00:00",450000.0,9000.0,2),
	 (3,500000.0,"2022-04-13 00:00:00",250000.0,5000.0,3),
	 (4,1200000.0,"2022-04-12 00:00:00",600000.0,6000.0,1),
	 (5,700000.0,"2022-02-28 00:00:00",350000.0,7000.0,2),
	 (6,1000000.0,"2022-01-04 00:00:00",500000.0,10000.0,3),
	 (7,800000.0,"2022-03-24 00:00:00",400000.0,8000.0,4);
	 
-- tipo_product0
	 
insert into salsamentaria.tipo_producto (idtipo_producto ,tipo_producto,estadotipo_producto) values
	 (1,"perecedero","a"),
	 (2,"no perecedero","a"),
	 (3,"perecedero","i"),
	 (4,"no perecedero","i");
	
-- categoria_producto

insert into salsamentaria.categoria_producto (id_categoria ,nombre_categoria,estado_categoria) values
	 (1,"carnes","a"),
	 (2,"pescado","i"),
	 (3,"granos","a"),
	 (4,"enlatados","i"),
	 (5,"salsas","a"),
	 (6,"galletas","i"),
	 (7,"verduras","a");
	
-- unidad_medida_producto

insert into salsamentaria.unidad_medida_producto (idunidad_medida,nombreunidad_medida,siglasunidad_medida,estadounidad_medida) values
	 (1,"gramos","g","a"),
	 (2,"libras","l","i"),
	 (3,"kilos","kg","a"),
	 (4,"arroba","ar","i"),
	 (5,"litros","li","a"),
	 (6,"centimetros cubicos","cc","i"),
	 (7,"paquete","p","a");
	
	
-- marca_producto

insert into salsamentaria.marca_producto (id_marca,nombre_marca,estado_marca) values
	 (1,"zenu","a"),
	 (2,"refisal","i"),
	 (3,"girasol","a"),
	 (4,"roa","i"),
	 (5,"no tiene","a"),
	 (6,"gourmet","i"),
	 (7,"fruco","a");
	
-- 	producto
insert into salsamentaria.producto (id_producto ,precio_producto,descripcion_producto,cantidad_producto,estado_producto,id_marca,idunidad_medida,id_categoria,idtipo_producto) values
	 (1,8000.0,"carne res",1,"a",1,2,1,1),
	 (2,1800.0,"sal cocina",4,"i",2,1,3,4),
	 (3,15000.0,"aceite cocina",3,"a",3,6,4,2),
	 (4,31000.0,"arroz",7,"i",4,4,3,2),
	 (5,2000.0,"tomate",8,"a",5,3,7,3),
	 (6,12000.0,"aceite cocina",2,"i",6,6,4,2),
	 (7,5000.0,"salsa mayonesa",8,"a",7,1,5,4);
	
-- detalle_compra

insert into salsamentaria.detalle_compra (subtotaldetalle_compra,cantidaddetalle_compra,valor_unitario,lotedetalle_compra,vencimientodetalle_compra,id_compra,id_producto) values
	 (100000.0,12,8000.0,"lote c1","2022-01-22",1,1),
	 (300000.0,17,2000.0,"lote c5","2022-02-01",1,2),
	 (200000.0,14,8000.0,"lote c2","2022-03-21",2,1),
	 (270000.0,12,12000.0,"lote c6","2022-02-12",2,3),
	 (250000.0,10,31000.0,"lote c7","2022-03-07",3,4),
	 (150000.0,8,15000.0,"lote c3","2022-01-22",3,6),
	 (250000.0,21,2000.0,"lote c4","2022-04-08",4,5);	
	
-- venta
	
insert into salsamentaria.venta (id_venta ,valortotal_venta,fecha_venta,total_iva,subtotal_venta,saldo_venta,total_descuento,id_usuario,idforma_pago,id_cliente) values
	 (1,100000.0,"2022-04-03 00:00:00",1000.0,10000.0,50000.0,12000.0,1,1,1),
	 (2,300000.0,"2022-04-13 00:00:00",3000.0,150000.0,15000.0,13000.0,2,2,2),
	 (3,150000.0,"2022-03-12 00:00:00",1500.0,75000.0,7500.0,11000.0,1,1,1),
	 (4,170000.0,"2022-04-03 00:00:00",1700.0,85000.0,8500.0,14000.0,3,3,3),
	 (5,200000.0,"2022-01-04 00:00:00",2000.0,100000.0,10000.0,10500.0,4,1,4),
	 (6,350000.0,"2022-02-03 00:00:00",3500.0,175000.0,17000.0,17000.0,6,2,5),
	 (7,100000.0,"2022-04-03 00:00:00",1000.0,50000.0,5000.0,5000.0,5,3,6);

-- 	detalle_venta
	
insert into salsamentaria.detalle_venta (cantidaddetalle_venta,subtotaldetalle_venta,id_venta,id_producto) values
	 (12,21600.0,1,2),
	 (15,465000.0,1,4),
	 (9,72000.0,2,1),
	 (5,9000.0,3,2),
	 (8,120000.0,4,3),
	 (6,72000.0,6,6),
	 (4,20000.0,7,7);	
	
-- credito

insert into salsamentaria.credito (id_credito ,saldo_credito,total_abono,estado_credito,id_venta) values
	 (1,200000.0,10000.0,"a",1),
	 (2,150000.0,12000.0,"i",2),
	 (3,300000.0,30000.0,"a",1),
	 (4,170000.0,17000.0,"i",3),
	 (5,200000.0,20000.0,"a",4),
	 (6,250000.0,25000.0,"i",5),
	 (7,120000.0,12000.0,"a",7);	

-- abono

insert into salsamentaria.abono (id_abono ,valor_abono,fecha_abono,id_credito,estado_abono) values
	 (1,20000.0,"2022-04-01 00:00:00",1,"a"),
	 (2,10000.0,"2022-04-02 00:00:00",2,"i"),
	 (3,15000.0,"2022-04-01 00:00:00",3,"a"),
	 (4,17000.0,"2022-02-04 00:00:00",5,"i"),
	 (5,14000.0,"2022-04-22 00:00:00",4,"a"),
	 (6,15000.0,"2022-04-11 00:00:00",1,"i"),
	 (7,20000.0,"2022-01-21 00:00:00",7,"a");
